const CONFIG={MOUSE_RANGE:400,MOUSE_FALLOFF:400,WEIGHT:{MIN:60,MAX:140,BASELINE:60},DISTORTION:{MIN:0,MAX:60,BASELINE:0},TILT_SENSITIVITY:60,DECAY:{CLICK:.95,KEYBOARD:.92,ORIENTATION:.98,TAP:.92},SPEED:{TYPING_RESET:1e3,TAP_RESET:1e3,DECAY_DELAY:500},FIXED_LETTERS:3,THROTTLE:{MOUSE:32,SCROLL:32,ORIENTATION:64},CACHE:{RECT_DURATION:100,MAX_CACHE_SIZE:50},PERFORMANCE:{TARGET_FPS:30,FRAME_TIME_THRESHOLD:33.33,ADAPTIVE_QUALITY:!0,FRAME_SKIP_THRESHOLD:.1,INACTIVITY_TIMEOUT:2e3},GLASS_GRID:{PANE_SIZE:70,GAP:0,REFRACTION_RADIUS:120,EMITTER_SIZE:140,MOBILE:{PANE_SIZE:60,GAP:0,REFRACTION_RADIUS:100,EMITTER_SIZE:120},SMALL_MOBILE:{PANE_SIZE:50,GAP:0,REFRACTION_RADIUS:80,EMITTER_SIZE:100}}};class PerformanceMonitor{constructor(){this.frameTimes=new Array(60).fill(0),this.frameIndex=0,this.lastFrameTime=0,this.qualityLevel=1,this.frameCount=0}startFrame(){this.lastFrameTime=performance.now()}endFrame(){const t=performance.now()-this.lastFrameTime;if(this.frameTimes[this.frameIndex]=t,this.frameIndex=(this.frameIndex+1)%60,this.frameCount=Math.min(this.frameCount+1,60),CONFIG.PERFORMANCE.ADAPTIVE_QUALITY&&this.frameCount>=30){const t=this.frameTimes.reduce((t,e)=>t+e,0)/this.frameCount;t>1.2*CONFIG.PERFORMANCE.FRAME_TIME_THRESHOLD?this.qualityLevel=Math.max(.3,.95*this.qualityLevel):t<.8*CONFIG.PERFORMANCE.FRAME_TIME_THRESHOLD&&(this.qualityLevel=Math.min(1,1.02*this.qualityLevel))}}getQualityLevel(){return this.qualityLevel}getAverageFrameTime(){return 0===this.frameCount?0:this.frameTimes.reduce((t,e)=>t+e,0)/this.frameCount}}class DOMCache{constructor(){this.cache=new Map,this.timestamps=new Map,this.rectPool=[],this.poolSize=20}getRect(t){const e=performance.now(),i=t;if(this.cache.has(i)){if(e-this.timestamps.get(i)<CONFIG.CACHE.RECT_DURATION)return this.cache.get(i)}const s=t.getBoundingClientRect();let o=this.rectPool.pop();return o||(o={}),o.left=s.left,o.top=s.top,o.width=s.width,o.height=s.height,o.centerX=s.left+s.width/2,o.centerY=s.top+s.height/2,this.cache.set(i,o),this.timestamps.set(i,e),this.cleanup(),o}cleanup(){if(this.cache.size>CONFIG.CACHE.MAX_CACHE_SIZE){const t=performance.now(),e=[];for(const[i,s]of this.timestamps)t-s>2*CONFIG.CACHE.RECT_DURATION&&e.push(i);e.forEach(t=>{const e=this.cache.get(t);e&&this.rectPool.length<this.poolSize&&this.rectPool.push(e),this.cache.delete(t),this.timestamps.delete(t)})}}clear(){for(const t of this.cache.values())this.rectPool.length<this.poolSize&&this.rectPool.push(t);this.cache.clear(),this.timestamps.clear()}}class Throttler{constructor(t){this.delay=t,this.lastCall=0,this.pendingCall=null}throttle(t){return(...e)=>{const i=performance.now();i-this.lastCall>=this.delay?(this.lastCall=i,t(...e)):(this.pendingCall&&clearTimeout(this.pendingCall),this.pendingCall=setTimeout(()=>{this.lastCall=performance.now(),t(...e)},this.delay-(i-this.lastCall)))}}}class ModalManager{constructor(){this.modal=document.getElementById("contactModal"),this.floatingBtn=document.getElementById("floatingInfoBtn"),this.isOpen=!1,this.lastScrollY=0,this.scrollThreshold=50,this.scrollTimeout=null,this.scrollStartTime=0,this.scrollStartY=0,this.initialize()}initialize(){this.floatingBtn&&this.floatingBtn.addEventListener("click",()=>{this.isOpen?this.closeModal():this.openModal()}),this.modal&&(this.modal.addEventListener("click",t=>{t.target===this.modal&&this.closeModal()}),document.addEventListener("keydown",t=>{"Escape"===t.key&&this.isOpen&&this.closeModal()})),this.lastScrollY=window.scrollY,this.setupScrollDetection()}setupScrollDetection(){let t=!1;const e=()=>{if(!this.isOpen)return;const e=window.scrollY;if(this.lastScrollY-e>0){this.scrollTimeout&&clearTimeout(this.scrollTimeout),t||(this.scrollStartY=e,this.scrollStartTime=Date.now(),t=!0);const i=this.scrollStartY-e,s=Date.now()-this.scrollStartTime;i>=this.scrollThreshold||s>=500?(this.closeModal(),t=!1):this.scrollTimeout=setTimeout(()=>{this.isOpen&&i>=this.scrollThreshold/2&&this.closeModal(),t=!1},300)}else t=!1,this.scrollTimeout&&(clearTimeout(this.scrollTimeout),this.scrollTimeout=null);this.lastScrollY=e};let i=!1;window.addEventListener("scroll",()=>{i||(requestAnimationFrame(()=>{e(),i=!1}),i=!0)},{passive:!0})}openModal(){this.modal&&!this.isOpen&&(this.isOpen=!0,this.modal.classList.add("active"),this.floatingBtn.classList.add("modal-active"),this.lastScrollY=window.scrollY,this.scrollStartY=window.scrollY,this.scrollStartTime=Date.now(),document.body.style.overflow="hidden",this.floatingBtn.style.transform="scale(0.95)",setTimeout(()=>{this.floatingBtn.style.transform=""},150))}closeModal(){this.modal&&this.isOpen&&(this.isOpen=!1,this.modal.classList.remove("active"),this.floatingBtn.classList.remove("modal-active"),this.scrollTimeout&&(clearTimeout(this.scrollTimeout),this.scrollTimeout=null),document.body.style.overflow="",this.floatingBtn.style.transform="scale(0.95)",setTimeout(()=>{this.floatingBtn.style.transform=""},150))}destroy(){document.body.style.overflow="",this.scrollTimeout&&clearTimeout(this.scrollTimeout)}}class InteractiveState{constructor(){this.mouseActive=!1,this.lastMouseX=0,this.lastMouseY=0,this.mouseVelocity=0,this.clickEffect=0,this.keyboardEffect=0,this.lastKeyTime=0,this.keyCount=0,this.typingSpeed=0,this.maxTypingSpeed=0,this.deviceOrientation={alpha:0,beta:0,gamma:0},this.orientationEffect=0,this.verticalTilt=0,this.horizontalTilt=0,this.tapEffect=0,this.lastTapTime=0,this.tapCount=0,this.tapSpeed=0}updateDecay(){this.clickEffect*=CONFIG.DECAY.CLICK,this.keyboardEffect*=CONFIG.DECAY.KEYBOARD,this.orientationEffect*=CONFIG.DECAY.ORIENTATION,this.tapEffect*=CONFIG.DECAY.TAP,Date.now()-this.lastKeyTime>CONFIG.SPEED.TYPING_RESET&&(this.typingSpeed*=.98,this.keyCount=Math.max(0,this.keyCount-.1)),Date.now()-this.lastTapTime>CONFIG.SPEED.TAP_RESET&&(this.tapSpeed*=.98,this.tapCount=Math.max(0,this.tapCount-.1))}}class EffectCalculator{static calculateMouseEffects(t,e,i,s,o,n,a=1){const r=t-i.centerX,h=e-i.centerY,l=r*r+h*h;if(l>=CONFIG.MOUSE_RANGE*CONFIG.MOUSE_RANGE)return{weight:0,distortion:0};const c=Math.sqrt(l),m=Math.max(0,1-c/CONFIG.MOUSE_FALLOFF);if(m<CONFIG.PERFORMANCE.FRAME_SKIP_THRESHOLD)return{weight:0,distortion:0};const d=Math.max(.5,a),u=o+.5*s,E=3*o+.3*s,p=a>.7?2:1,T=15*Math.sin(u*p)*m*d,I=8*Math.sin(E)*m*d,f=Math.min(20,.1*n.mouseVelocity)*m,C=a>.5?Math.sin(8*o+.8*s)*f*d:0,M=c/8,S=Math.max(0,CONFIG.DISTORTION.MAX-M)*m,y=Math.max(CONFIG.WEIGHT.MIN,CONFIG.WEIGHT.MAX-c/15)*m;return{weight:Math.max(CONFIG.WEIGHT.MIN,Math.min(CONFIG.WEIGHT.MAX,y+I+f)),distortion:Math.max(0,Math.min(CONFIG.DISTORTION.MAX,S+T+C))}}static calculateBaselineEffects(t,e,i,s=1){if(i.clickEffect+i.keyboardEffect+i.tapEffect+Math.abs(i.verticalTilt)+Math.abs(i.horizontalTilt)<CONFIG.PERFORMANCE.FRAME_SKIP_THRESHOLD)return{weight:CONFIG.WEIGHT.BASELINE,distortion:CONFIG.DISTORTION.BASELINE};const o=CONFIG.WEIGHT.BASELINE,n=CONFIG.DISTORTION.BASELINE,a=Math.max(.5,s),r=e+.4*t,h=6*e+.6*t,l=15*Math.sin(12*e+r)*i.clickEffect*a,c=10*Math.sin(h)*i.clickEffect*a,m=Math.min(2,i.typingSpeed/3),d=25*Math.sin(e*(20+10*m)+.3*t)*i.keyboardEffect*a,u=15*Math.sin(e*(8+5*m)+.7*t)*i.keyboardEffect*a,E=s>.6?10*Math.sin(30*e+.9*t)*i.keyboardEffect*m*a:0,p=s>.6?8*Math.cos(25*e+.2*t)*i.keyboardEffect*m*a:0,T=Math.min(2,i.tapSpeed/3),I=20*Math.sin(e*(18+8*T)+.4*t)*i.tapEffect*a,f=12*Math.sin(e*(6+4*T)+.8*t)*i.tapEffect*a,C=s>.6?8*Math.sin(28*e+.7*t)*i.tapEffect*T*a:0,M=s>.6?6*Math.cos(22*e+.3*t)*i.tapEffect*T*a:0,S=60*i.verticalTilt;return{weight:o+c+u+f+80*i.horizontalTilt,distortion:n+l+d+E+p+I+C+M+S}}}class MobileSensorManager{constructor(t){this.state=t,this.isInitialized=!1,this.permissionButton=null,this.orientationThrottler=new Throttler(CONFIG.THROTTLE.ORIENTATION)}async initialize(){if(!this.isInitialized)try{if("undefined"!=typeof DeviceOrientationEvent&&"function"==typeof DeviceOrientationEvent.requestPermission){this.checkStoredPermission()?this.setupOrientationListener():this.showPermissionButton()}else this.setupOrientationListener();this.isInitialized=!0}catch(t){console.error("Mobile sensor initialization failed:",t)}}checkStoredPermission(){try{return"true"===localStorage.getItem("motionEffectsEnabled")}catch(t){return!1}}storePermission(t){try{localStorage.setItem("motionEffectsEnabled",t.toString())}catch(t){console.warn("Could not store permission preference:",t)}}clearStoredPermission(){try{localStorage.removeItem("motionEffectsEnabled")}catch(t){console.warn("Could not clear permission preference:",t)}}showPermissionButton(){if(this.permissionContainer)return;this.permissionContainer=document.createElement("div"),this.permissionContainer.className="permission-container",this.permissionButton=document.createElement("button"),this.permissionButton.textContent="Enable Motion-Sensitive Logo",this.permissionButton.className="permission-button",this.permissionButton.addEventListener("click",async()=>{try{"granted"===await DeviceOrientationEvent.requestPermission()?(this.setupOrientationListener(),this.hidePermissionButton(),this.storePermission(!0)):this.storePermission(!1)}catch(t){console.error("Permission request failed:",t),this.storePermission(!1)}}),this.dismissButton=document.createElement("button"),this.dismissButton.innerHTML="&times;",this.dismissButton.className="dismiss-button",this.dismissButton.setAttribute("aria-label","Dismiss"),this.dismissButton.addEventListener("click",()=>{this.hidePermissionButton(),this.storePermission(!1)}),this.permissionContainer.appendChild(this.permissionButton),this.permissionContainer.appendChild(this.dismissButton);const t=document.querySelector(".hero");if(t){const e=document.querySelector(".subtitle");if(e)e.parentNode.insertBefore(this.permissionContainer,e.nextSibling);else{const e=document.querySelector("#splash");e?e.parentNode.insertBefore(this.permissionContainer,e.nextSibling):t.appendChild(this.permissionContainer)}}else{const t=document.querySelector(".subtitle");t&&t.parentNode?t.parentNode.insertBefore(this.permissionContainer,t.nextSibling):document.body.appendChild(this.permissionContainer)}}hidePermissionButton(){this.permissionContainer&&this.permissionContainer.parentNode&&(this.permissionContainer.parentNode.removeChild(this.permissionContainer),this.permissionContainer=null,this.permissionButton=null,this.dismissButton=null)}setupOrientationListener(){const t=this.orientationThrottler.throttle(t=>{this.state.deviceOrientation.alpha=t.alpha||0,this.state.deviceOrientation.beta=t.beta||0,this.state.deviceOrientation.gamma=t.gamma||0,this.state.verticalTilt=Math.abs(this.state.deviceOrientation.beta-90)/CONFIG.TILT_SENSITIVITY,this.state.horizontalTilt=Math.abs(this.state.deviceOrientation.gamma)/CONFIG.TILT_SENSITIVITY,this.state.orientationEffect=Math.min(1,(this.state.verticalTilt+this.state.horizontalTilt)/2)});window.addEventListener("deviceorientation",t)}}class GlassGridManager{constructor(){this.gridContainer=document.getElementById("glassPaneGrid"),this.panes=[],this.mouseX=0,this.mouseY=0,this.isInitialized=!1,this.isMoving=!1,this.movementThreshold=5,this.lastMouseX=0,this.lastMouseY=0,this.initialize()}initialize(){this.gridContainer?(null!==this.gridContainer.offsetParent&&this.createGlassPanes(),this.isInitialized=!0):console.warn("Glass grid container not found")}createGlassPanes(){const t=this.gridContainer.getBoundingClientRect(),e=this.getResponsiveSettings(),i=e.PANE_SIZE,s=e.GAP,o=Math.ceil(t.width/(i+s)),n=Math.ceil(t.height/(i+s));this.gridContainer.innerHTML="",this.panes=[];for(let t=0;t<n;t++)for(let t=0;t<o;t++){const t=document.createElement("div");t.className="glass-pane",t.style.width=`${i}px`,t.style.height=`${i}px`;const e=.85+.15*Math.random();t.style.opacity=e,this.gridContainer.appendChild(t),this.panes.push(t)}}getResponsiveSettings(){const t=window.innerWidth;return t<=480?CONFIG.GLASS_GRID.SMALL_MOBILE:t<=768?CONFIG.GLASS_GRID.MOBILE:{PANE_SIZE:CONFIG.GLASS_GRID.PANE_SIZE,GAP:CONFIG.GLASS_GRID.GAP,REFRACTION_RADIUS:CONFIG.GLASS_GRID.REFRACTION_RADIUS,EMITTER_SIZE:CONFIG.GLASS_GRID.EMITTER_SIZE}}setupMouseTracking(){let t;const e=e=>{this.mouseX=e.clientX,this.mouseY=e.clientY;const i=Math.sqrt(Math.pow(this.mouseX-this.lastMouseX,2)+Math.pow(this.mouseY-this.lastMouseY,2));this.isMoving=i>this.movementThreshold;const s=this.getResponsiveSettings();this.gradientEmitter.style.left=this.mouseX-s.EMITTER_SIZE/2+"px",this.gradientEmitter.style.top=this.mouseY-s.EMITTER_SIZE/2+"px",this.updateCirclePositions(),this.updateRefractionEffects(),this.lastMouseX=this.mouseX,this.lastMouseY=this.mouseY,t&&cancelAnimationFrame(t),t=requestAnimationFrame(()=>{this.updateRefractionEffects()})};let i=0;document.addEventListener("mousemove",t=>{const s=performance.now();s-i>=CONFIG.THROTTLE.MOUSE&&(i=s,e(t))}),window.addEventListener("resize",()=>{setTimeout(()=>{this.createGlassPanes()},100)})}updateCirclePositions(){const t=this.getResponsiveSettings().EMITTER_SIZE;this.isMoving?(this.circlePositions[0]={x:this.mouseX,y:this.mouseY},this.circlePositions[1].x+=.3*(this.circlePositions[0].x-this.circlePositions[1].x),this.circlePositions[1].y+=.3*(this.circlePositions[0].y-this.circlePositions[1].y),this.circlePositions[2].x+=.25*(this.circlePositions[1].x-this.circlePositions[2].x),this.circlePositions[2].y+=.25*(this.circlePositions[1].y-this.circlePositions[2].y),this.circlePositions[3].x+=.2*(this.circlePositions[2].x-this.circlePositions[3].x),this.circlePositions[3].y+=.2*(this.circlePositions[2].y-this.circlePositions[3].y)):(this.circlePositions[0]={x:this.mouseX,y:this.mouseY},this.circlePositions[1]={x:this.mouseX,y:this.mouseY},this.circlePositions[2]={x:this.mouseX,y:this.mouseY},this.circlePositions[3]={x:this.mouseX,y:this.mouseY});this.circleCluster.querySelectorAll(".circle").forEach((e,i)=>{const s=this.circlePositions[i+1];e.style.left=s.x-t/2+"px",e.style.top=s.y-t/2+"px"})}updateRefractionEffects(){const t=this.getResponsiveSettings().REFRACTION_RADIUS;this.panes.forEach((e,i)=>{const s=e.getBoundingClientRect(),o=s.left+s.width/2,n=s.top+s.height/2,a=Math.sqrt(Math.pow(this.mouseX-o,2)+Math.pow(this.mouseY-n,2));if(a<t){const i=1-a/t,r=Math.pow(i,1.5),h=(this.mouseX-s.left)/s.width*100,l=(this.mouseY-s.top)/s.height*100,c=Math.sqrt(Math.pow(h-50,2)+Math.pow(l-50,2))/50;e.classList.add("refracting"),e.style.setProperty("--refraction-intensity",r),e.style.setProperty("--mouse-x",`${h}%`),e.style.setProperty("--mouse-y",`${l}%`),e.style.setProperty("--warp-intensity",c);const m=(this.mouseX-o)/t*3,d=`perspective(800px) rotateX(${(this.mouseY-n)/t*3}deg) rotateY(${m}deg) scale(${1+.03*r})`;e.style.transform=d}else e.classList.remove("refracting"),e.style.removeProperty("--refraction-intensity"),e.style.removeProperty("--mouse-x"),e.style.removeProperty("--mouse-y"),e.style.removeProperty("--warp-intensity"),e.style.transform=""})}destroy(){this.panes=[],this.isInitialized=!1}}class InteractiveTextApp{constructor(){this.letters=document.querySelectorAll("#splash span"),this.state=new InteractiveState,this.mobileSensors=new MobileSensorManager(this.state),this.performanceMonitor=new PerformanceMonitor,this.domCache=new DOMCache,this.mouseThrottler=new Throttler(CONFIG.THROTTLE.MOUSE),this.scrollThrottler=new Throttler(CONFIG.THROTTLE.SCROLL),this.modalManager=new ModalManager,this.glassGridManager=new GlassGridManager,this.animationId=null,this.isVisible=!0,this.isActive=!0,this.lastActivityTime=Date.now(),this.frameSkipCounter=0,this.targetFrameRate=this.detectOptimalFrameRate(),this.letterData=this.precalculateLetterData(),this.initialize()}detectOptimalFrameRate(){const t=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),e=navigator.hardwareConcurrency&&navigator.hardwareConcurrency<=4;return t||e?20:30}precalculateLetterData(){const t=[];for(let e=0;e<this.letters.length;e++)t.push({element:this.letters[e],index:e,isFixed:e>=this.letters.length-CONFIG.FIXED_LETTERS,lastWeight:null,lastDistortion:null,lastColor:null});return t}initialize(){this.setupEventListeners(),this.setupMobileSensors(),this.startAnimation()}setupEventListeners(){const t=this.mouseThrottler.throttle(this.handleMouseMove.bind(this));document.addEventListener("mousemove",t),document.addEventListener("click",()=>{this.state.clickEffect=1,this.updateActivity()}),document.addEventListener("keydown",this.handleKeyDown.bind(this)),document.addEventListener("touchstart",this.handleTouchStart.bind(this));const e=this.scrollThrottler.throttle(this.handleScroll.bind(this));document.addEventListener("scroll",e),document.addEventListener("visibilitychange",this.handleVisibilityChange.bind(this)),window.addEventListener("focus",this.handleWindowFocus.bind(this)),window.addEventListener("blur",this.handleWindowBlur.bind(this)),this.checkScrollReveal()}handleVisibilityChange(){this.isVisible=!document.hidden,this.updateActivity()}handleWindowFocus(){this.isActive=!0,this.updateActivity()}handleWindowBlur(){this.isActive=!1}updateActivity(){this.lastActivityTime=Date.now()}setupMobileSensors(){this.mobileSensors.initialize()}handleMouseMove(t){const e=.001*Date.now(),i=t.clientX-this.state.lastMouseX,s=t.clientY-this.state.lastMouseY;this.state.mouseVelocity=Math.sqrt(i*i+s*s),this.state.lastMouseX=t.clientX,this.state.lastMouseY=t.clientY,this.updateActivity();let o=!1;const n=this.performanceMonitor.getQualityLevel(),a=t.clientX,r=t.clientY;this.letterData.forEach(t=>{if(t.isFixed)return void this.updateFixedLetter(t);const i=this.domCache.getRect(t.element),s=EffectCalculator.calculateMouseEffects(a,r,i,t.index,e,this.state,n);(s.weight>0||s.distortion>0)&&(o=!0,this.updateLetterStyles(t,s.weight,s.distortion))}),this.state.mouseActive=o}handleKeyDown(t){const e=Date.now(),i=e-this.state.lastKeyTime;i<CONFIG.SPEED.TYPING_RESET?(this.state.keyCount++,this.state.typingSpeed=this.state.keyCount/(i/1e3),this.state.maxTypingSpeed=Math.max(this.state.maxTypingSpeed,this.state.typingSpeed)):(this.state.keyCount=1,this.state.typingSpeed=1),this.state.lastKeyTime=e;const s=Math.min(3,this.state.typingSpeed/2);this.state.keyboardEffect=1*s}handleTouchStart(t){const e=Date.now(),i=e-this.state.lastTapTime;i<CONFIG.SPEED.TAP_RESET?(this.state.tapCount++,this.state.tapSpeed=this.state.tapCount/(i/1e3)):(this.state.tapCount=1,this.state.tapSpeed=1),this.state.lastTapTime=e;const s=Math.min(3,this.state.tapSpeed/2);this.state.tapEffect=1*s}handleScroll(){this.checkScrollReveal()}checkScrollReveal(){const t=document.querySelectorAll(".description"),e=.8*window.innerHeight;t.forEach((t,i)=>{if(t.classList.contains("revealed"))return;const s=this.domCache.getRect(t),o=s.top,n=s.height;o<e&&o+n>0&&setTimeout(()=>{t.classList.add("revealed")},200*i)})}updateFixedLetter(t){const e=CONFIG.WEIGHT.BASELINE,i=CONFIG.DISTORTION.BASELINE;this.updateLetterStyles(t,e,i,"#FFFFFF")}updateLetterStyles(t,e,i,s=null){t.lastWeight===e&&t.lastDistortion===i||(t.element.style.fontVariationSettings=`"wght" ${e.toFixed(1)}, "DIST" ${i.toFixed(1)}`,t.lastWeight=e,t.lastDistortion=i),s&&t.lastColor!==s&&(t.element.style.color=s,t.lastColor=s)}updateLetters(t){const e=this.performanceMonitor.getQualityLevel(),i=this.state.clickEffect>.01||this.state.keyboardEffect>.01||this.state.tapEffect>.01||Math.abs(this.state.verticalTilt)>.01||Math.abs(this.state.horizontalTilt)>.01;this.letterData.forEach(s=>{if(s.isFixed)return void this.updateFixedLetter(s);let o=CONFIG.WEIGHT.BASELINE,n=CONFIG.DISTORTION.BASELINE;if(i){const i=EffectCalculator.calculateBaselineEffects(s.index,t,this.state,e);o=i.weight,n=i.distortion}if(this.state.mouseActive){const i=this.domCache.getRect(s.element),a=EffectCalculator.calculateMouseEffects(this.state.lastMouseX,this.state.lastMouseY,i,s.index,t,this.state,e);o=Math.max(CONFIG.WEIGHT.MIN,Math.min(CONFIG.WEIGHT.MAX,o+a.weight)),n=Math.max(0,Math.min(CONFIG.DISTORTION.MAX,n+a.distortion))}this.updateLetterStyles(s,o,n)})}startAnimation(){const t=e=>{if(this.performanceMonitor.startFrame(),!this.shouldAnimate())return void(this.animationId=requestAnimationFrame(t));const i=.001*e;this.state.updateDecay(),this.updateLetters(i),this.performanceMonitor.endFrame();const s=this.performanceMonitor.getAverageFrameTime(),o=1e3/this.targetFrameRate;s>1.5*o?setTimeout(()=>{this.animationId=requestAnimationFrame(t)},Math.max(0,o-s)):this.animationId=requestAnimationFrame(t)};this.animationId=requestAnimationFrame(t)}shouldAnimate(){if(!this.isVisible)return!1;if(!this.isActive)return!1;if(Date.now()-this.lastActivityTime>CONFIG.PERFORMANCE.INACTIVITY_TIMEOUT){if(this.frameSkipCounter++,this.frameSkipCounter<10)return!1;this.frameSkipCounter=0}else this.frameSkipCounter=0;return!0}destroy(){this.animationId&&cancelAnimationFrame(this.animationId),this.scrollThrottler.pendingCall&&clearTimeout(this.scrollThrottler.pendingCall),this.mouseThrottler.pendingCall&&clearTimeout(this.mouseThrottler.pendingCall),this.domCache.clear(),this.modalManager.destroy(),this.glassGridManager.destroy()}}const app=new InteractiveTextApp;window.addEventListener("beforeunload",()=>{app.destroy()});